- name: Upload Images to R2
  env:
    AWS_ACCESS_KEY_ID: ${{ secrets.R2_ACCESS_KEY_ID }}
    AWS_SECRET_ACCESS_KEY: ${{ secrets.R2_SECRET_ACCESS_KEY }}
    AWS_DEFAULT_REGION: auto
    BUCKET: ${{ secrets.R2_BUCKET_NAME }}
    ENDPOINT: ${{ secrets.R2_ENDPOINT }}
  run: |
    aws s3 sync public/ s3://$BUCKET/ \
      --endpoint-url $ENDPOINT \
      --acl public-read \
      --exclude "*" \
      --include "*.jpg" --include "*.jpeg" --include "*.png" \
      --include "*.gif" --include "*.webp" --include "*.svg" \
      --include "*.bmp" --include "*.ico" \
      --delete || echo "⚠️ R2 upload failed (continuing...)"

- name: Replace Image Links with R2 URLs
  env:
    R2_PUBLIC_URL: ${{ secrets.R2_PUBLIC_URL }}  # https://cdn.yuzexiaoyu.space
  run: |
    python scripts/replace-img-links.py public "$R2_PUBLIC_URL"